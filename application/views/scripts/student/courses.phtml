<div class="row main-row" style='width: auto; min-width: 1024px; max-width: 90%; min-height: 95%' ng-controller='MessageCtrl'>
    <div class="col-sm-12">
        <table class='table'>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Course name</th>
                    <th>Course number</th>
                    <th>Units</th>
                    <th>Description</th>
                    <th>Taking as</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th>Advisor comment</th>
                    <th>Messages</th>
                </tr>
            </thead>
            <tbody>
                <?php 
                $index = 1;
                foreach ($this->all_courses as $course) { ?>
                <tr>
                    <td><?= $index ?></td>
                    <td><?= $course->course_name ?></td>
                    <td><?php if ($course->taking_as != 'place-out') echo $course->course_number; ?></td>
                    <td><?php if ($course->taking_as != 'place-out') echo $course->units; ?></td>
                    <td><?= $course->course_description ?></td>
                    <td><?php
                        switch ($course->taking_as) {
                            case "free-elective":
                            echo "Free elective";
                            break;

                            case "application-elective":
                            echo "Restricted application elective";
                            break;

                            default:
                            echo ucfirst($course->taking_as);
                        } ?></td>
                    <td><?php if ($course->taking_as != 'place-out') echo $course->submission_time; ?></td>
                    <td><?php
                        switch ($course->status) {
                            case 'taking':
                            echo "<span>In progress</span>";
                            break;

                            case 'taken':
                            echo "<span class='text-success'>Taken</span>";
                            break;

                            case 'submitted':
                            echo "<span class='text-info'>Submitted and under review</span>";
                            break;

                            case 'rejected':
                            echo "<span class='text-danger'>Rejected</span>";
                            break;

                            case 'approved':
                            echo "<span class='text-success'>Approved</span>";
                            break;

                            case 'need-clarification':
                            echo "<span class='text-warning'>Clarification needed</span>";
                            break;

                            case 'satisfied':
                            echo "<span class='text-success'>Satisfied</span>";
                            break;

                            case 'not-satisfied':
                            echo "<span class='text-danger'>Not satisfied</span>";
                            break;
                        }

                         ?></td>
                    <td><?php if ($course->taking_as != 'place-out') echo $course->comment; ?></td>
                    <td><a class='view-msg' ng-click='showMessages(<?= $course->id ?>)' href='javascript: ;'>View</a></td>
                </tr>
                <?php $index++; } ?>
            </tbody>
        </table>
    </div>
</div>

<div class="modal" ng-controller="MessageCtrl" id="messages" tabindex="-1" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="modalTitle">Messages</h4>
            </div>
            <div class="modal-body" style='padding-bottom: 0px'>
                <input type='text' ng-model='courseId' style='display: none'>

                <div ng-repeat='msg in messages' ng-class="{ student: 'text-info', advisor: 'text-success' } [msg.origin]">
                    <!-- Header: showing name and time -->
                    <div style='margin-top: 10px'>
                        <span style='font-weight: bold'>{{ msg.origin == "student" ? "You" : "Advisor" }}:</span>
                        <span style='float: right'>{{ msg.time | formattime }}</span>
                    </div>
                    <!-- Content area -->
                    {{ msg.message }}
                </div>
                <div ng-if='messages.length == 0'>No messages to show.</div>
            </div>
            <div class="modal-footer">
                <button type="button" ng-click='send()' class="btn btn-primary" style='float: right'>Send</button>
                <div style="overflow: hidden; padding-right: 1em">
                    <input type="text" ng-model='currentMessage' placeholder='Enter questions or clarifications' class="form-control" style='width: 100%'>
                </div>
            </div>
        </div>
    </div>
</div>